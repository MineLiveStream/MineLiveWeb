import{s as c,t as D,a as z}from"./api-BD18ZUdi.js";import{c as S}from"./permission-C1g7fiWc.js";import{r as C,_ as q,c as j,a as e,w as n,F,e as s,o as N,b as a,f as l}from"./index-DFaeQSUc.js";let v=1;const I=8;let _=1;function L(i){document.getElementById("streamBtn").addEventListener("click",function(){C.push("/stream")});const t=document.getElementById("deleteDialog"),y=document.getElementById("dialogCancelBtn"),b=document.getElementById("dialogConfirmBtn"),p=document.getElementById("material-list-tbody");if(p.innerHTML="",i&&i.list){if(_=i.total/I,_=Math.ceil(i.total/I),_===0&&(_=1),document.getElementById("pageText").textContent="第"+v+"页，共"+_+"页",i.list.length===0){p.innerHTML='<tr><td colspan="6" class="mdui-text-center">此页没有素材，请先上传</td></tr>';return}i.list.forEach(u=>{const o=document.createElement("tr"),g=document.createElement("td");g.textContent=u.name,o.appendChild(g);const m=document.createElement("td");u.type==="PIC"?m.textContent="图片":m.textContent="视频",o.appendChild(m);const h=new Date(u.uploadTime).toLocaleString(),d=document.createElement("td");d.textContent=h,o.appendChild(d);const x=(u.size/(1024*1024)).toFixed(2),E=document.createElement("td");E.textContent=x+" MB",o.appendChild(E);const f=document.createElement("td");f.className="div",f.innerHTML="<mdui-chip>删除</mdui-chip>",f.addEventListener("click",()=>{t.open=!0,t.description=u.name,y.addEventListener("click",()=>{t.open=!1}),b.addEventListener("click",()=>{t.open=!1;const k={id:u.id};fetch(z+"/material",{method:"DELETE",headers:{Authorization:"Bearer "+D(),"Content-Type":"application/json"},body:JSON.stringify(k)}).then(r=>{if(!r.ok)throw new Error("Network response was not ok.");return r.json()}).then(r=>{r.code===200?(c({message:"删除成功"}),o.parentNode.removeChild(o)):c({message:r.msg})}).catch(r=>{console.error("There has been a problem with your fetch operation:",r)})})}),o.appendChild(f),p.appendChild(o)})}else p.innerHTML='<tr><td colspan="6" class="mdui-text-center">获取推流失败，请刷新列表</td></tr>'}async function T(){try{const i=new URLSearchParams({page:v.toString(),size:I.toString()}),t=z+`/material?${i.toString()}`;return await(await fetch(t,{headers:{Authorization:`Bearer ${D()}`}})).json()}catch(i){return console.error("请求素材库时出错:",i),null}}function P(){T().then(o=>{if(o&&o.code===401){C.push("/?login=1");return}L(o)}).catch(o=>{console.error("处理响应时出错:",o)}),S(),document.getElementById("lastPageBtn").addEventListener("click",function(){v>1?(v--,w()):c({message:"已经到尽头啦>.<"})}),document.getElementById("nextPageBtn").addEventListener("click",function(){_>v?(v++,w()):c({message:"已经到尽头啦>.<"})}),document.getElementById("logoutBtn").addEventListener("click",function(){localStorage.removeItem("userToken"),localStorage.removeItem("userAdmin"),C.push("/")});const i=document.getElementById("uploadBtn"),t=document.getElementById("uploadDialog"),y=document.getElementById("uploadDialogCancelBtn");document.getElementById("uploadDialogConfirmBtn").addEventListener("click",function(){p.click(),t.open=!1}),y.addEventListener("click",function(){t.open=!1}),i.addEventListener("click",function(){t.open=!0});const p=document.getElementById("fileInput");p.addEventListener("change",function(){const o=p.files[0];if(o)if(o.size>125829120)c({message:"文件大小不得超过120MB"});else{c({message:"正在上传，请耐心等待"}),i.loading=!0;const m=new FormData;m.append("file",o),m.append("name",o.name.replace(/\s/g,"_"));const h={Authorization:`Bearer ${D()||"undefined"}`};fetch(z+"/material",{method:"POST",headers:h,body:m}).then(d=>{if(!d.ok)throw new Error("Network response was not ok.");return d.json()}).then(d=>{d.code===200?(c({message:"上传成功"}),T().then(B=>{L(B)}).catch(B=>{console.error("处理响应时出错:",B)})):c({message:d.msg}),i.loading=!1})}else c({message:"请选择要上传的文件"})});const u=document.getElementById("refreshBtn");u.addEventListener("click",function(){u.loading=!0,w(),u.loading=!1,c({message:"刷新成功"})})}function w(){T().then(i=>{i.code===200&&L(i)})}const $={mounted(){P()}};function A(i,t,y,b,p,u){const o=s("mdui-top-app-bar-title"),g=s("mdui-button-icon"),m=s("mdui-tooltip"),h=s("mdui-top-app-bar"),d=s("mdui-navigation-rail-item"),B=s("mdui-navigation-rail"),x=s("mdui-table-fluid"),E=s("mdui-container"),f=s("mdui-segmented-button"),k=s("mdui-segmented-button-group"),r=s("mdui-button"),M=s("mdui-dialog");return N(),j(F,null,[e(h,{"scroll-behavior":"elevate",style:{"background-color":"rgba(var(--mdui-color-primary-container, 0.8))"}},{default:n(()=>[t[1]||(t[1]=a("div",{style:{"margin-left":"80px"}},null,-1)),t[2]||(t[2]=a("img",{src:"https://s21.ax1x.com/2024/04/07/pFq2AoR.png",alt:"alternative",style:{width:"2.5rem",height:"2.5rem"}},null,-1)),e(o,null,{default:n(()=>t[0]||(t[0]=[l("素材列表")])),_:1}),e(m,{content:"上传素材"},{default:n(()=>[e(g,{variant:"filled",icon:"arrow_upward",id:"uploadBtn",title:"上传素材"})]),_:1}),t[3]||(t[3]=a("input",{type:"file",id:"fileInput",style:{display:"none"}},null,-1)),t[4]||(t[4]=a("div",{style:{"margin-left":"1px"}},null,-1)),e(m,{content:"刷新列表"},{default:n(()=>[e(g,{variant:"filled",icon:"refresh",id:"refreshBtn"})]),_:1})]),_:1}),e(B,{divider:"","padding-left":"",id:"rail",value:"material"},{default:n(()=>[e(d,{icon:"videocam",id:"streamBtn",value:"stream"},{default:n(()=>t[5]||(t[5]=[l("推流")])),_:1}),e(d,{icon:"topic",id:"materialBtn",value:"material"},{default:n(()=>t[6]||(t[6]=[l("素材")])),_:1}),e(d,{icon:"help_center",href:"https://www.yuque.com/seeds-ejjgd/py7vim",target:"_blank",id:"groupBtn",value:"help"},{default:n(()=>t[7]||(t[7]=[l("教程")])),_:1}),e(d,{icon:"group",href:"https://qm.qq.com/q/hpYH0xIsuY",target:"_blank",id:"groupBtn",value:"group"},{default:n(()=>t[8]||(t[8]=[l("加群")])),_:1}),e(d,{icon:"local_fire_department",href:"https://www.beishaoidc.cn/aff/TKYYFUGE",target:"_blank",id:"adv",value:"adv"},{default:n(()=>t[9]||(t[9]=[l("北少云")])),_:1}),e(d,{slot:"bottom",icon:"logout",id:"logoutBtn",value:"logout"},{default:n(()=>t[10]||(t[10]=[l("登出")])),_:1})]),_:1}),e(E,{class:"mdui-m-t-2"},{default:n(()=>[e(x,null,{default:n(()=>t[11]||(t[11]=[a("table",{class:"mdui-table mdui-table-striped"},[a("thead",null,[a("tr",null,[a("th",null,"名称"),a("th",null,"类型"),a("th",null,"上传时间"),a("th",null,"大小"),a("th",null,"操作")])]),a("tbody",{id:"material-list-tbody"})],-1)])),_:1})]),_:1}),e(k,{"full-width":""},{default:n(()=>[e(f,{icon:"arrow_backward",id:"lastPageBtn"}),e(f,{id:"pageText"},{default:n(()=>t[12]||(t[12]=[l("第1页，共1页")])),_:1}),e(f,{"end-icon":"arrow_forward",id:"nextPageBtn"})]),_:1}),e(M,{id:"deleteDialog","close-on-overlay-click":"",headline:"确认删除素材?",class:"example-action"},{default:n(()=>[e(r,{slot:"action",variant:"text",id:"dialogCancelBtn"},{default:n(()=>t[13]||(t[13]=[l("取消")])),_:1}),e(r,{slot:"action",variant:"tonal",id:"dialogConfirmBtn"},{default:n(()=>t[14]||(t[14]=[l("删除")])),_:1})]),_:1}),e(M,{id:"uploadDialog","close-on-overlay-click":"","stacked-actions":"",headline:"素材规范",class:"example-action"},{default:n(()=>[t[18]||(t[18]=a("p",null,[l("文件大小 < 120M"),a("br"),l("支持格式 .mp4 .png .jpg"),a("br"),l("1080p及以上视频分辨率")],-1)),e(r,{slot:"action",variant:"tonal",id:"uploadDialogConfirmBtn"},{default:n(()=>t[15]||(t[15]=[l("选择文件")])),_:1}),e(r,{slot:"action",variant:"text",id:"uploadDialogHelpBtn",target:"_blank",href:"https://www.yuque.com/seeds-ejjgd/py7vim/qvvp0a5q4xfqhdld"},{default:n(()=>t[16]||(t[16]=[l("教程")])),_:1}),e(r,{slot:"action",variant:"text",id:"uploadDialogCancelBtn"},{default:n(()=>t[17]||(t[17]=[l("取消")])),_:1})]),_:1})],64)}const V=q($,[["render",A]]);export{V as default};

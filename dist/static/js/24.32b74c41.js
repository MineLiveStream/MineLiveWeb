"use strict";(self["webpackChunkmine_live_web"]=self["webpackChunkmine_live_web"]||[]).push([[24],{1631:function(e,t,n){n.d(t,{A:function(){return i},F:function(){return a}});n(4114);var o=n(5098);const a="https://api.minelive.top";function i(){const e=localStorage.getItem("userToken");if(e)return e;o.A.push("/?login=1")}},2643:function(e,t,n){n.r(t),n.d(t,{default:function(){return w}});var o=n(6768);const a=(0,o.Lk)("div",{style:{"margin-left":"80px"}},null,-1),i=(0,o.Lk)("img",{src:"https://s21.ax1x.com/2024/04/07/pFq2AoR.png",alt:"alternative",style:{width:"2.5rem",height:"2.5rem"}},null,-1),l=(0,o.Lk)("div",{style:{"margin-left":"1px"}},null,-1),r=(0,o.Lk)("table",{class:"mdui-table mdui-table-striped"},[(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("th",null,"名称"),(0,o.Lk)("th",null,"推流地址"),(0,o.Lk)("th",null,"推流密钥"),(0,o.Lk)("th",null,"素材名称"),(0,o.Lk)("th",null,"用户邮箱"),(0,o.Lk)("th",null,"剩余时长"),(0,o.Lk)("th",null,"当前状态"),(0,o.Lk)("th",null,"操作")])]),(0,o.Lk)("tbody",{id:"material-list-tbody"})],-1),d=(0,o.Lk)("div",{id:"clientDiv"},null,-1),c=(0,o.Lk)("div",{id:"logDiv"},null,-1),s=(0,o.Lk)("br",null,null,-1);function u(e,t,n,u,m,g){const h=(0,o.g2)("mdui-top-app-bar-title"),p=(0,o.g2)("mdui-button-icon"),f=(0,o.g2)("mdui-tooltip"),v=(0,o.g2)("mdui-top-app-bar"),b=(0,o.g2)("mdui-navigation-rail-item"),y=(0,o.g2)("mdui-navigation-rail"),k=(0,o.g2)("mdui-text-field"),E=(0,o.g2)("mdui-table-fluid"),B=(0,o.g2)("mdui-container"),L=(0,o.g2)("mdui-segmented-button"),F=(0,o.g2)("mdui-segmented-button-group"),C=(0,o.g2)("mdui-button"),x=(0,o.g2)("mdui-dialog"),w=(0,o.g2)("mdui-menu-item"),_=(0,o.g2)("mdui-select");return(0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.bF)(v,{"scroll-behavior":"elevate",style:{"background-color":"rgba(var(--mdui-color-primary-container, 0.8))"}},{default:(0,o.k6)((()=>[a,i,(0,o.bF)(h,{id:"titleText"},{default:(0,o.k6)((()=>[(0,o.eW)("管理推流")])),_:1}),(0,o.bF)(f,{content:"接管列表"},{default:(0,o.k6)((()=>[(0,o.bF)(p,{variant:"filled",icon:"computer",id:"clientBtn"})])),_:1}),l,(0,o.bF)(f,{content:"刷新列表"},{default:(0,o.k6)((()=>[(0,o.bF)(p,{variant:"filled",icon:"refresh",id:"refreshBtn"})])),_:1})])),_:1}),(0,o.bF)(y,{divider:"","padding-left":"",id:"rail",value:"admin"},{default:(0,o.k6)((()=>[(0,o.bF)(b,{icon:"videocam",id:"streamBtn",value:"stream"},{default:(0,o.k6)((()=>[(0,o.eW)("推流")])),_:1}),(0,o.bF)(b,{icon:"topic",id:"materialBtn",value:"material"},{default:(0,o.k6)((()=>[(0,o.eW)("素材")])),_:1}),(0,o.bF)(b,{icon:"help_center",href:"https://www.yuque.com/seeds-ejjgd/py7vim",target:"_blank",id:"groupBtn",value:"help"},{default:(0,o.k6)((()=>[(0,o.eW)("教程")])),_:1}),(0,o.bF)(b,{icon:"group",href:"https://qm.qq.com/q/hpYH0xIsuY",target:"_blank",id:"groupBtn",value:"group"},{default:(0,o.k6)((()=>[(0,o.eW)("加群")])),_:1}),(0,o.bF)(b,{slot:"bottom",icon:"logout",id:"logoutBtn",value:"logout"},{default:(0,o.k6)((()=>[(0,o.eW)("登出")])),_:1}),(0,o.bF)(b,{icon:"manage_accounts",value:"admin",id:"adminBtn"},{default:(0,o.k6)((()=>[(0,o.eW)("管理")])),_:1})])),_:1}),(0,o.Lk)("form",null,[(0,o.bF)(k,{clearable:"",label:"搜索",type:"search",icon:"search",id:"search","full-width":""})]),(0,o.bF)(B,{class:"mdui-m-t-2"},{default:(0,o.k6)((()=>[(0,o.bF)(E,null,{default:(0,o.k6)((()=>[r])),_:1})])),_:1}),(0,o.bF)(F,{"full-width":""},{default:(0,o.k6)((()=>[(0,o.bF)(L,{icon:"arrow_backward",id:"lastPageBtn"}),(0,o.bF)(L,{id:"pageText"},{default:(0,o.k6)((()=>[(0,o.eW)("第1页，共1页")])),_:1}),(0,o.bF)(L,{"end-icon":"arrow_forward",id:"nextPageBtn"})])),_:1}),(0,o.bF)(x,{id:"deleteDialog","close-on-overlay-click":"",headline:"确认删除推流?",class:"example-action"},{default:(0,o.k6)((()=>[(0,o.bF)(C,{slot:"action",variant:"text",id:"dialogCancelBtn"},{default:(0,o.k6)((()=>[(0,o.eW)("取消")])),_:1}),(0,o.bF)(C,{slot:"action",variant:"tonal",id:"dialogConfirmBtn"},{default:(0,o.k6)((()=>[(0,o.eW)("删除")])),_:1})])),_:1}),(0,o.bF)(x,{id:"clientDialog","close-on-overlay-click":"",headline:"接管列表",class:"example-action"},{default:(0,o.k6)((()=>[d,(0,o.bF)(C,{slot:"action",variant:"tonal",id:"clientDialogCloseBtn"},{default:(0,o.k6)((()=>[(0,o.eW)("关闭")])),_:1})])),_:1}),(0,o.bF)(x,{id:"changeDialog","close-on-overlay-click":"",headline:"更新推流",class:"example-action"},{default:(0,o.k6)((()=>[(0,o.bF)(k,{style:{"margin-bottom":"16px"},label:"名称",id:"streamName"}),(0,o.bF)(k,{style:{"margin-bottom":"16px"},label:"推流地址",id:"streamUrl"}),(0,o.bF)(k,{style:{"margin-bottom":"16px"},label:"推流密钥",id:"streamKey"}),(0,o.bF)(k,{style:{"margin-bottom":"16px"},type:"date",label:"到期时间",id:"expiredTime"}),(0,o.bF)(_,{label:"素材类型",id:"selectMenu"},{default:(0,o.k6)((()=>[(0,o.bF)(w,{value:"HD_VIDEO"},{default:(0,o.k6)((()=>[(0,o.eW)("高清视频")])),_:1}),(0,o.bF)(w,{value:"VIDEO"},{default:(0,o.k6)((()=>[(0,o.eW)("视频")])),_:1}),(0,o.bF)(w,{value:"PIC"},{default:(0,o.k6)((()=>[(0,o.eW)("图片")])),_:1})])),_:1}),(0,o.bF)(C,{slot:"action",variant:"text",id:"changeCancelBtn"},{default:(0,o.k6)((()=>[(0,o.eW)("取消")])),_:1}),(0,o.bF)(C,{slot:"action",variant:"tonal",id:"changeConfirmBtn"},{default:(0,o.k6)((()=>[(0,o.eW)("确定")])),_:1})])),_:1}),(0,o.bF)(x,{fullscreen:"",class:"example-fullscreen",id:"logDialog"},{default:(0,o.k6)((()=>[(0,o.eW)(" 运行日志"),c,s,(0,o.bF)(C,{id:"logDialogCloseBtn"},{default:(0,o.k6)((()=>[(0,o.eW)("关闭")])),_:1})])),_:1})],64)}n(4114),n(4603),n(7566),n(8721);var m=n(1631),g=n(3567),h=n(5098);let p=1;const f=8;let v=1,b=0;function y(){const e=localStorage.getItem("userAdmin");e&&"true"===e||h.A.push("/stream"),L(),document.getElementById("materialBtn").addEventListener("click",(function(){h.A.push("/material")})),document.getElementById("streamBtn").addEventListener("click",(function(){h.A.push("/stream")}));const t=document.getElementById("changeDialog");document.getElementById("search").addEventListener("change",(function(){p=1,L()})),document.getElementById("logoutBtn").addEventListener("click",(function(){localStorage.removeItem("userToken"),localStorage.removeItem("userAdmin"),h.A.push("/")})),document.getElementById("changeConfirmBtn").addEventListener("click",(function(){const e=document.getElementById("streamName").value,n=document.getElementById("streamUrl").value,o=document.getElementById("streamKey").value,a=document.getElementById("expiredTime").value,i=document.getElementById("selectMenu").value;let l;a&&(l=new Date(a).getTime()-(new Date).getTime(),l<0&&(l=0));const r={id:b,name:e||void 0,url:n||void 0,key:o||void 0,expired:l,materialType:i||void 0};fetch(m.F+"/stream",{method:"PUT",headers:{Authorization:"Bearer "+(0,m.A)(),"Content-Type":"application/json"},body:JSON.stringify(r)}).then((e=>{if(!e.ok)throw new Error("错误响应码");return e.json()})).then((e=>{t.open=!1,200===e.code?((0,g.o)({message:"更新成功"}),B().then((e=>{E(e)})).catch((e=>{console.error("处理响应时出错:",e)}))):(0,g.o)({message:e.msg})})).catch((e=>{console.error("检测到错误",e),(0,g.o)({message:"操作出错，请重试！"})}))})),document.getElementById("changeCancelBtn").addEventListener("click",(function(){t.open=!1})),document.getElementById("refreshBtn").addEventListener("click",(function(){L(),(0,g.o)({message:"刷新成功"})})),document.getElementById("lastPageBtn").addEventListener("click",(function(){p>1?(p--,L()):(0,g.o)({message:"已经到尽头啦>.<"})})),document.getElementById("nextPageBtn").addEventListener("click",(function(){v>p?(p++,L()):(0,g.o)({message:"已经到尽头啦>.<"})}));const n=document.getElementById("clientDialog");document.getElementById("clientDialogCloseBtn").addEventListener("click",(function(){n.open=!1}));const o=document.getElementById("clientBtn");o.addEventListener("click",(function(){o.loading=!0,fetch(m.F+"/admin/client",{method:"GET",headers:{Authorization:"Bearer "+(0,m.A)(),"Content-Type":"application/json"}}).then((e=>{if(!e.ok)throw new Error("错误响应码");return e.json()})).then((e=>{if(200===e.code){const t=document.getElementById("clientDiv");while(t.firstChild)t.removeChild(t.firstChild);let a=0,i=0;Object.keys(e.data).forEach((o=>{const l=e.data[o];a+=e.data[o].length,i++;const r=document.createElement("mdui-tooltip");r.content="点击给予更多接管";const d=document.createElement("mdui-chip");d.innerHTML="机器"+i+" 接管数量"+l.length,d.style="margin-bottom: 1px",d.addEventListener("click",(()=>{n.open=!1;const e={id:o};fetch(m.F+"/admin/client",{method:"POST",headers:{Authorization:"Bearer "+(0,m.A)(),"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>{if(!e.ok)throw new Error("错误响应码");return e.json()})).then((e=>{200===e.code?(0,g.o)({message:"已向该子端发出推流，请稍后"}):(0,g.o)({message:e.msg}),setTimeout((()=>{B().then((e=>{E(e)})).catch((e=>{console.error("处理响应时出错:",e)}))}),5e3)})).catch((e=>{console.error("检测到错误",e),(0,g.o)({message:"操作出错，请重试！"})}))})),r.appendChild(d),t.appendChild(r),t.appendChild(document.createElement("br"))})),n.headline="接管列表("+a+")",n.open=!0,o.loading=!1}else(0,g.o)({message:e.msg})})).catch((e=>{console.error("检测到错误",e),(0,g.o)({message:"操作出错，请重试！"})}))}))}function k(e){return e.length>20?e.substring(0,20)+"...":e}function E(e){const t=document.getElementById("material-list-tbody"),n=document.getElementById("deleteDialog"),o=document.getElementById("dialogCancelBtn"),a=document.getElementById("dialogConfirmBtn"),i=document.getElementById("changeDialog");if(t.innerHTML="",e&&e.list){if(v=Math.ceil(e.total/f),document.getElementById("titleText").textContent="管理推流 ("+e.streaming+"/"+e.total+"直播中)",0===v&&(v=1),document.getElementById("pageText").textContent="第"+p+"页，共"+v+"页",0===e.list.length)return void(t.innerHTML='<tr><td colspan="6" class="mdui-text-center">没有推流可展示</td></tr>');e.list.forEach((e=>{const l=document.createElement("tr");["name","streamUrl","streamKey","materialName","email"].forEach((t=>{const n=document.createElement("td");if("streamUrl"===t||"streamKey"===t){const o=document.createElement("a"),a=document.createElement("mdui-tooltip");a.content="点击复制",n.addEventListener("click",(()=>{navigator.clipboard.writeText(e[t]).then((()=>{(0,g.o)({message:"复制成功"})}))})),o.innerHTML=k(e[t]),a.appendChild(o),n.appendChild(a)}else n.textContent=k(e[t]);if("materialName"===t){const t=document.createElement("mdui-tooltip"),o=document.createElement("mdui-icon");"HD_VIDEO"===e.materialType?(t.content="该推流允许使用高清视频或图片素材",o.style="color: orange",o.name="hd"):"VIDEO"===e.materialType?(t.content="该推流允许使用视频或图片素材",o.style="color: orange",o.name="ondemand_video"):(t.content="该推流仅能使用图片素材",o.style="color: gray",o.name="photo"),t.appendChild(o),n.appendChild(t)}l.appendChild(n)}));const r=document.createElement("td");e.expired<=0?r.textContent="已到期":e.expired<6e4?r.textContent="即将到期":e.expired<36e5?r.textContent=(e.expired/6e4).toFixed(0)+"分钟":r.textContent=(e.expired/36e5).toFixed(1)+"小时",l.appendChild(r);const d=document.createElement("td"),c=document.createElement("mdui-switch");c.className="div",c.checked="OFF"!==e.status,c.addEventListener("change",(()=>{const t={id:e.id};fetch(m.F+"/switch-stream",{method:"POST",headers:{Authorization:"Bearer "+(0,m.A)(),"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>{if(!e.ok)throw new Error("错误响应码");return e.json()})).then((e=>{if(200===e.code){const t="ON"===e.status;c.disabled=!0,(0,g.o)({message:"推流"+(t?"开启":"关闭")+"中，请稍等..."})}else c.disabled=!0,(0,g.o)({message:e.msg});setTimeout((()=>{B().then((e=>{E(e)})).catch((e=>{console.error("处理响应时出错:",e)}))}),5e3)})).catch((e=>{console.error("检测到错误",e),(0,g.o)({message:"操作出错，请重试！"})}))})),d.appendChild(c),l.appendChild(d);const s=document.createElement("td"),u=document.createElement("mdui-chip");u.style="margin-right: 1px",u.innerHTML="更改",u.addEventListener("click",(()=>{i.headline="更新推流",i.description="无变更内容可留空",i.open=!0,b=e.id})),s.appendChild(u);const h=document.createElement("mdui-chip");h.innerHTML="日志",h.style="margin-right: 1px",h.addEventListener("click",(()=>{const t=document.getElementById("logDialog"),n=document.getElementById("logDiv");n.innerHTML="";const o=new URLSearchParams({id:e.id}),a=m.F+`/stream-log?${o.toString()}`;fetch(a,{headers:{Authorization:`Bearer ${(0,m.A)()}`}}).then((e=>{if(!e.ok)throw(0,g.o)({message:"获取日志出错"}),new Error("错误响应码");return e.json()})).then((e=>{200===e.code?0===e.log.length?(0,g.o)({message:"该推流暂无日志，请先启动"}):(e.log.forEach((e=>{const t=document.createElement("p");t.innerHTML=e,n.appendChild(t)})),t.open=!0):(0,g.o)({message:"获取日志失败"+resJson.msg})})).catch((e=>{console.error("检测到错误",e)}));const i=document.getElementById("logDialogCloseBtn");i.addEventListener("click",(()=>t.open=!1))})),s.appendChild(h);const p=document.createElement("mdui-chip");p.innerHTML="删除",p.addEventListener("click",(()=>{n.open=!0,n.description=e.name,o.addEventListener("click",(()=>{n.open=!1})),a.addEventListener("click",(()=>{n.open=!1;const t={id:e.id};fetch(m.F+"/stream",{method:"DELETE",headers:{Authorization:"Bearer "+(0,m.A)(),"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>{if(!e.ok)throw new Error("错误响应码");return e.json()})).then((e=>{200===e.code?((0,g.o)({message:"删除成功"}),l.parentNode.removeChild(l)):(0,g.o)({message:e.msg})})).catch((e=>{console.error("检测到错误",e)}))}))})),s.appendChild(p),l.appendChild(s),t.appendChild(l)}))}else t.innerHTML='<tr><td colspan="6" class="mdui-text-center">获取推流失败，请刷新列表</td></tr>'}async function B(){try{const e=document.getElementById("search"),t=new URLSearchParams({page:p.toString(),size:f.toString()});e.value&&t.append("email",e.value);const n=m.F+`/admin/stream?${t.toString()}`,o=await fetch(n,{headers:{Authorization:`Bearer ${(0,m.A)()}`}});return await o.json()}catch(e){return console.error("请求推流时出错:",e),null}}function L(){B().then((e=>{e&&401===e.code?h.A.push("/?login=1"):E(e)})).catch((e=>{console.error("处理响应时出错:",e)}))}var F={mounted(){y()}},C=n(1241);const x=(0,C.A)(F,[["render",u]]);var w=x},6955:function(e,t,n){var o=n(2140),a=n(4901),i=n(4576),l=n(8227),r=l("toStringTag"),d=Object,c="Arguments"===i(function(){return arguments}()),s=function(e,t){try{return e[t]}catch(n){}};e.exports=o?i:function(e){var t,n,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=s(t=d(e),r))?n:c?i(t):"Object"===(o=i(t))&&a(t.callee)?"Arguments":o}},2140:function(e,t,n){var o=n(8227),a=o("toStringTag"),i={};i[a]="z",e.exports="[object z]"===String(i)},655:function(e,t,n){var o=n(6955),a=String;e.exports=function(e){if("Symbol"===o(e))throw new TypeError("Cannot convert a Symbol value to a string");return a(e)}},2812:function(e){var t=TypeError;e.exports=function(e,n){if(e<n)throw new t("Not enough arguments");return e}},4603:function(e,t,n){var o=n(6840),a=n(9504),i=n(655),l=n(2812),r=URLSearchParams,d=r.prototype,c=a(d.append),s=a(d["delete"]),u=a(d.forEach),m=a([].push),g=new r("a=1&a=2&b=3");g["delete"]("a",1),g["delete"]("b",void 0),g+""!=="a=2"&&o(d,"delete",(function(e){var t=arguments.length,n=t<2?void 0:arguments[1];if(t&&void 0===n)return s(this,e);var o=[];u(this,(function(e,t){m(o,{key:t,value:e})})),l(t,1);var a,r=i(e),d=i(n),g=0,h=0,p=!1,f=o.length;while(g<f)a=o[g++],p||a.key===r?(p=!0,s(this,a.key)):h++;while(h<f)a=o[h++],a.key===r&&a.value===d||c(this,a.key,a.value)}),{enumerable:!0,unsafe:!0})},7566:function(e,t,n){var o=n(6840),a=n(9504),i=n(655),l=n(2812),r=URLSearchParams,d=r.prototype,c=a(d.getAll),s=a(d.has),u=new r("a=1");!u.has("a",2)&&u.has("a",void 0)||o(d,"has",(function(e){var t=arguments.length,n=t<2?void 0:arguments[1];if(t&&void 0===n)return s(this,e);var o=c(this,e);l(t,1);var a=i(n),r=0;while(r<o.length)if(o[r++]===a)return!0;return!1}),{enumerable:!0,unsafe:!0})},8721:function(e,t,n){var o=n(3724),a=n(9504),i=n(2106),l=URLSearchParams.prototype,r=a(l.forEach);o&&!("size"in l)&&i(l,"size",{get:function(){var e=0;return r(this,(function(){e++})),e},configurable:!0,enumerable:!0})}}]);
//# sourceMappingURL=24.32b74c41.js.map